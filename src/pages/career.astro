---
import { getCollection } from "astro:content";
import { marked } from "marked";
import PrimeTimeline from "../components/PrimeTimeline.jsx";
import PaperLayout from "../layouts/PaperLayout.astro";

const careerEntries = await getCollection("career");

const sortedCareer = careerEntries.sort(
  (a, b) => b.data.startDate.valueOf() - a.data.startDate.valueOf(),
);

// Prepare Data Object (Clean JSON, not HTML strings)
const events = sortedCareer.map((entry) => {
  const start = entry.data.startDate.toLocaleDateString("en-US", {
    month: "short",
    year: "numeric",
  });

  const end = entry.data.endDate
    ? entry.data.endDate.toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
      })
    : "Present";

  return {
    title: entry.data.title,
    company: entry.data.company,
    type: entry.data.type,
    image: entry.data.image,

    date: `${start} - ${end}`,

    html: entry.body ? marked.parse(entry.body) : "",
    skills: entry.data.tags || [],
  };
});
---

<PaperLayout title="Career Timeline">
  <div class="wrapper">
    <PrimeTimeline client:only="react" events={events} />
  </div>
</PaperLayout>
